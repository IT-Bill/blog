---
import '../styles/global.css';
import { Navbar } from '../components/Navbar';
import { Sidebar } from '../components/Sidebar';
import { ArrowUp } from 'lucide-react';
import { getCollection } from 'astro:content';
import type { Post } from '../types';

interface Props {
	title?: string;
	showSidebar?: boolean;
}

const { title = "Bill的小破站", showSidebar = true } = Astro.props;
const pageTitle = title === "Bill的小破站" ? title : `${title} | Bill的小破站`;

// 获取所有文章用于侧边栏
const allPosts = await getCollection('posts');
const posts: Post[] = allPosts.map(post => ({
	id: post.id,
	title: post.data.title,
	summary: post.data.summary,
	date: post.data.date,
	category: post.data.category,
	cover: post.data.cover,
	tags: post.data.tags,
	views: post.data.views,
	comments: post.data.comments,
})).sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
---

<!doctype html>
<html lang="zh-CN">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet" />
		<meta name="generator" content={Astro.generator} />
		<title>{pageTitle}</title>
	</head>
	<body>
		<!-- Shooting stars background effect -->
		<div class="shooting-stars">
			<div class="star"></div>
			<div class="star"></div>
			<div class="star"></div>
			<div class="star"></div>
			<div class="star"></div>
			<div class="star"></div>
			<div class="star"></div>
			<div class="star"></div>
		</div>

		<div class="min-h-screen pb-12">
			<Navbar client:load />

			<main class="container mx-auto px-4 md:px-6 pt-18">
				<div class={showSidebar ? "grid grid-cols-1 lg:grid-cols-12 gap-6" : ""}>
					
					{showSidebar && (
						<!-- Sidebar (Sticky) -->
						<div class="lg:col-span-3 hidden lg:block">
							<div class="sticky top-14">
								<Sidebar posts={posts} client:load />
							</div>
						</div>
					)}

					<!-- Main Content -->
					<div class={showSidebar ? "lg:col-span-9 min-h-[80vh]" : ""}>
						<slot />
					</div>

					{showSidebar && (
						<!-- Mobile Sidebar -->
						<div class="lg:hidden">
							<Sidebar posts={posts} client:load />
						</div>
					)}

				</div>
			</main>

			<!-- Footer -->
			<footer class="mt-20 text-center text-xs text-dimmed pb-8">
				<p>© 2025 • Bill的小破站 • Powered by Astro</p>
				<p class="mt-1">建站 1506 天 03 时 59 分 27 秒</p>
			</footer>

			<!-- Back to top button -->
			<button 
				id="back-to-top"
				class="fixed bottom-8 right-8 p-3 bg-accent/80 hover:bg-accent text-white rounded-full shadow-lg backdrop-blur-sm transition-all z-40 hidden md:block"
			>
				<ArrowUp size={20} client:load />
			</button>
		</div>

		<script>
			document.getElementById('back-to-top')?.addEventListener('click', () => {
				window.scrollTo({top: 0, behavior: 'smooth'});
			});
		</script>
	</body>
</html>

<style is:global>
	html,
	body {
		margin: 0;
		width: 100%;
		height: 100%;
	}
</style>
